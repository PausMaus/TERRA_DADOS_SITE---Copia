{% load static %}
{% load umbrella_tags %}
<link rel="stylesheet" href="{% static 'umbrella360/style.css' %}?v=9">
<link rel="stylesheet" href="{% static 'umbrella360/style_refatorado.css' %}?v=2">
<link rel="stylesheet" href="{% static 'umbrella360/report_novo.css' %}?v=1">
<script src="{% static 'umbrella360/theme-toggle.js' %}?v=2"></script>
<script src="{% static 'umbrella360/table-sort.js' %}?v=1"></script>

<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Performance dos Motoristas - Umbrella360</title>
  </head>
  <body>
    <!-- Bot√£o de altern√¢ncia de tema -->
    <button id="theme-toggle" class="theme-toggle" title="Alternar tema">
      <span class="theme-icon">‚óê</span> Noite de Ver√£o
    </button>
    
    <div class="header">
      <div class="menu-buttons">
            <a href="{% url 'index' %}" class="btn btn-primary">In√≠cio</a>
            <a href="{% url 'report_empresa' %}" class="btn btn-secondary">Painel</a>
            <a href="{% url 'ranking_empresa' %}" class="btn btn-secondary">Ranking</a>
      </div>
    </div>

    <main style="max-width: 1400px; margin: 0 auto; padding: 2rem;">

      <!-- Cabe√ßalho -->


      <!-- Estat√≠sticas Gerais da Frota -->
            <!-- üî• NOVO: Formul√°rio de Filtros -->
      <div style="background: white; border-radius: 15px; padding: 1.5rem; margin-bottom: 2rem; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
        <form method="get" id="filterForm" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; align-items: end;">
          
          <!-- Seletor de Per√≠odo R√°pido -->
          <div>
            <label for="periodo_dias" style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #2c3e50;">
              üìÖ Per√≠odo R√°pido
            </label>
            <select name="periodo_dias" id="periodo_dias" onchange="toggleDateInputs(this.value)" 
                    style="width: 100%; padding: 0.75rem; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 1rem;">
              <option value="7" {% if periodo_dias == '7' %}selected{% endif %}>√öltimos 7 dias</option>
              <option value="15" {% if periodo_dias == '15' %}selected{% endif %}>√öltimos 15 dias</option>
              <option value="30" {% if periodo_dias == '30' or not periodo_dias %}selected{% endif %}>√öltimos 30 dias</option>
              <option value="60" {% if periodo_dias == '60' %}selected{% endif %}>√öltimos 60 dias</option>
              <option value="90" {% if periodo_dias == '90' %}selected{% endif %}>√öltimos 90 dias</option>
              <option value="todos" {% if periodo_dias == 'todos' %}selected{% endif %}>Todos os dados</option>
              <option value="personalizado" {% if data_inicio and data_fim %}selected{% endif %}>üìÜ Personalizado</option>
            </select>
          </div>
          
          <!-- Data In√≠cio (oculto por padr√£o) -->
          <div id="dataInicioDiv" style="{% if not data_inicio %}display: none;{% endif %}">
            <label for="data_inicio" style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #2c3e50;">
              Data In√≠cio
            </label>
            <input type="date" name="data_inicio" id="data_inicio" value="{{ data_inicio }}"
                  style="width: 100%; padding: 0.75rem; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 1rem;">
          </div>
          
          <!-- Data Fim (oculto por padr√£o) -->
          <div id="dataFimDiv" style="{% if not data_fim %}display: none;{% endif %}">
            <label for="data_fim" style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #2c3e50;">
              Data Fim
            </label>
            <input type="date" name="data_fim" id="data_fim" value="{{ data_fim }}"
                  style="width: 100%; padding: 0.75rem; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 1rem;">
          </div>
          
          <!-- Bot√£o Aplicar -->
          <div>
            <button type="submit" style="width: 100%; padding: 0.75rem 1.5rem; background: linear-gradient(135deg, #667eea, #764ba2); 
                    color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; font-size: 1rem; 
                    transition: transform 0.2s;">
              üîç Aplicar Filtro
            </button>
          </div>
          
          <!-- Bot√£o Limpar -->
          <div>
            <a href="{% url 'performance_motoristas' %}" style="display: block; width: 100%; padding: 0.75rem 1.5rem; 
              background: #6c757d; color: white; border: none; border-radius: 8px; font-weight: 600; 
              text-align: center; text-decoration: none; transition: transform 0.2s;">
              üîÑ Limpar Filtros
            </a>
          </div>
          
        </form>
      </div>

      <div class="stats-overview" style="background: linear-gradient(135deg, #667eea, #764ba2); border-radius: 15px; padding: 2rem; margin-bottom: 2rem; color: white;">
        <h2 style="text-align: center; margin-bottom: 2rem; font-size: 2rem;">üìä Performance dos Motoristas</h2>

        <div class="stats-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem;">
          <div class="stat-card" style="background: rgba(255, 255, 255, 0.15); padding: 1.5rem; border-radius: 8px; text-align: center; border: 1px solid rgba(255, 255, 255, 0.2); backdrop-filter: blur(10px);">
            <div class="stat-value" style="font-size: 2.5rem; font-weight: 700; color: white; margin: 0.5rem 0;">
              {{ stats_gerais.total_motoristas }}
            </div>
            <div class="stat-label" style="color: rgba(255, 255, 255, 0.9); font-size: 0.9rem; font-weight: 500; text-transform: uppercase;">Total de Motoristas</div>
          </div>
          
          <div class="stat-card" style="background: rgba(255, 255, 255, 0.15); padding: 1.5rem; border-radius: 8px; text-align: center; border: 1px solid rgba(255, 255, 255, 0.2); backdrop-filter: blur(10px);">
            <div class="stat-value" style="font-size: 2.5rem; font-weight: 700; color: white; margin: 0.5rem 0;">
              {{ stats_gerais.total_pontos|floatformat:0 }}
            </div>
            <div class="stat-label" style="color: rgba(255, 255, 255, 0.9); font-size: 0.9rem; font-weight: 500; text-transform: uppercase;">Total de Pontos Analisados</div>
          </div>
          
          <div class="stat-card" style="background: rgba(255, 255, 255, 0.15); padding: 1.5rem; border-radius: 8px; text-align: center; border: 1px solid rgba(255, 255, 255, 0.2); backdrop-filter: blur(10px);">
            <div class="stat-value" style="font-size: 2.5rem; font-weight: 700; color: white; margin: 0.5rem 0;">
              {{ stats_gerais.rpm_medio_geral|floatformat:0 }}
            </div>
            <div class="stat-label" style="color: rgba(255, 255, 255, 0.9); font-size: 0.9rem; font-weight: 500; text-transform: uppercase;">RPM M√©dio Geral</div>
          </div>
          
          <div class="stat-card" style="background: rgba(255, 255, 255, 0.15); padding: 1.5rem; border-radius: 8px; text-align: center; border: 1px solid rgba(255, 255, 255, 0.2); backdrop-filter: blur(10px);">
            <div class="stat-value" style="font-size: 2.5rem; font-weight: 700; color: white; margin: 0.5rem 0;">
              {{ stats_gerais.velocidade_media_geral|floatformat:0 }}
            </div>
            <div class="stat-label" style="color: rgba(255, 255, 255, 0.9); font-size: 0.9rem; font-weight: 500; text-transform: uppercase;">Velocidade M√©dia (km/h)</div>
          </div>
          
          <div class="stat-card" style="background: rgba(33, 150, 243, 0.3); padding: 1.5rem; border-radius: 8px; text-align: center; border: 1px solid rgba(255, 255, 255, 0.3); backdrop-filter: blur(10px);">
            <div class="stat-value" style="font-size: 2.5rem; font-weight: 700; color: #bbdefb; margin: 0.5rem 0;">
              {{ stats_gerais.perc_azul_geral|floatformat:1 }}%
            </div>
            <div class="stat-label" style="color: rgba(255, 255, 255, 0.9); font-size: 0.9rem; font-weight: 500; text-transform: uppercase;">üîµ Faixa Azul (Econ√¥mica)</div>
          </div>
          
          <div class="stat-card" style="background: rgba(40, 167, 69, 0.3); padding: 1.5rem; border-radius: 8px; text-align: center; border: 1px solid rgba(255, 255, 255, 0.3); backdrop-filter: blur(10px);">
            <div class="stat-value" style="font-size: 2.5rem; font-weight: 700; color: #d4edda; margin: 0.5rem 0;">
              {{ stats_gerais.perc_verde_geral|floatformat:1 }}%
            </div>
            <div class="stat-label" style="color: rgba(255, 255, 255, 0.9); font-size: 0.9rem; font-weight: 500; text-transform: uppercase;">üü¢ Faixa Verde (Ideal)</div>
          </div>
          
          <div class="stat-card" style="background: rgba(255, 152, 0, 0.3); padding: 1.5rem; border-radius: 8px; text-align: center; border: 1px solid rgba(255, 255, 255, 0.3); backdrop-filter: blur(10px);">
            <div class="stat-value" style="font-size: 2.5rem; font-weight: 700; color: #ffe0b2; margin: 0.5rem 0;">
              {{ stats_gerais.perc_amarela_geral|floatformat:1 }}%
            </div>
            <div class="stat-label" style="color: rgba(255, 255, 255, 0.9); font-size: 0.9rem; font-weight: 500; text-transform: uppercase;">üü° Faixa Amarela (Aten√ß√£o)</div>
          </div>
          
          <div class="stat-card" style="background: rgba(220, 53, 69, 0.3); padding: 1.5rem; border-radius: 8px; text-align: center; border: 1px solid rgba(255, 255, 255, 0.3); backdrop-filter: blur(10px);">
            <div class="stat-value" style="font-size: 2.5rem; font-weight: 700; color: #f8d7da; margin: 0.5rem 0;">
              {{ stats_gerais.perc_vermelha_geral|floatformat:1 }}%
            </div>
            <div class="stat-label" style="color: rgba(255, 255, 255, 0.9); font-size: 0.9rem; font-weight: 500; text-transform: uppercase;">üî¥ Faixa Vermelha (Cr√≠tico)</div>
          </div>
          
          <div class="stat-card" style="background: rgba(108, 117, 125, 0.3); padding: 1.5rem; border-radius: 8px; text-align: center; border: 1px solid rgba(255, 255, 255, 0.3); backdrop-filter: blur(10px);">
            <div class="stat-value" style="font-size: 2.5rem; font-weight: 700; color: #e0e0e0; margin: 0.5rem 0;">
              {{ stats_gerais.perc_ocioso_geral|floatformat:1 }}%
            </div>
            <div class="stat-label" style="color: rgba(255, 255, 255, 0.9); font-size: 0.9rem; font-weight: 500; text-transform: uppercase;">‚ö™ Ociosidade</div>
          </div>
        </div>
      </div>

      <!-- Legenda das Faixas de RPM -->
      <div style="background: white; border-radius: 10px; padding: 1.5rem; margin-bottom: 2rem; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
          <div style="display: flex; align-items: center; gap: 0.5rem; padding: 0.75rem; background: #e3f2fd; border-radius: 8px; border-left: 4px solid #2196F3;">
            <span style="font-size: 1.5rem;">üîµ</span>
            <div>
              <strong>Azul (350-799 RPM)</strong>
              <p style="margin: 0; font-size: 0.85rem; color: #555;">Econ√¥mica</p>
            </div>
          </div>
          
          <div style="display: flex; align-items: center; gap: 0.5rem; padding: 0.75rem; background: #e8f5e9; border-radius: 8px; border-left: 4px solid #4CAF50;">
            <span style="font-size: 1.5rem;">üü¢</span>
            <div>
              <strong>Verde (800-1300 RPM)</strong>
              <p style="margin: 0; font-size: 0.85rem; color: #555;">Ideal</p>
            </div>
          </div>
          
          <div style="display: flex; align-items: center; gap: 0.5rem; padding: 0.75rem; background: #fff3e0; border-radius: 8px; border-left: 4px solid #FF9800;">
            <span style="font-size: 1.5rem;">üü°</span>
            <div>
              <strong>Amarela (1301-2300 RPM)</strong>
              <p style="margin: 0; font-size: 0.85rem; color: #555;">Aten√ß√£o</p>
            </div>
          </div>
          
          <div style="display: flex; align-items: center; gap: 0.5rem; padding: 0.75rem; background: #ffebee; border-radius: 8px; border-left: 4px solid #f44336;">
            <span style="font-size: 1.5rem;">üî¥</span>
            <div>
              <strong>Vermelha (‚â•2301 RPM)</strong>
              <p style="margin: 0; font-size: 0.85rem; color: #555;">Cr√≠tica</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Gr√°ficos de Dispers√£o: Faixas de RPM vs Score -->
      {% if motoristas_performance %}
      <div style="background: white; border-radius: 15px; padding: 2rem; margin-bottom: 2rem; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
        <h3 style="text-align: center; margin-bottom: 2rem; color: #2c3e50; font-size: 1.5rem;">
          üìä Correla√ß√£o: Faixas de RPM vs Score de Performance
        </h3>
        
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(500px, 1fr)); gap: 2rem;">
          <!-- Gr√°fico 1: % Faixa Verde vs Score -->
          <div>
            <h4 style="text-align: center; color: #4CAF50; margin-bottom: 1rem;">üü¢ Faixa Verde (Ideal) vs Score</h4>
            <canvas id="chartVerdeScore" style="max-height: 300px;"></canvas>
          </div>
          
          <!-- Gr√°fico 2: % Faixa Vermelha vs Score -->
          <div>
            <h4 style="text-align: center; color: #f44336; margin-bottom: 1rem;">üî¥ Faixa Vermelha (Cr√≠tica) vs Score</h4>
            <canvas id="chartVermelhaScore" style="max-height: 300px;"></canvas>
          </div>
          
          <!-- Gr√°fico 3: RPM M√©dio vs Score -->
          <div>
            <h4 style="text-align: center; color: #667eea; margin-bottom: 1rem;">‚öôÔ∏è RPM M√©dio vs Score</h4>
            <canvas id="chartRPMScore" style="max-height: 300px;"></canvas>
          </div>
          
          <!-- Gr√°fico 4: % Ociosidade vs Score -->
          <div>
            <h4 style="text-align: center; color: #6c757d; margin-bottom: 1rem;">‚ö™ Ociosidade vs Score</h4>
            <canvas id="chartOciosoScore" style="max-height: 300px;"></canvas>
          </div>
        </div>
        
        <!-- Estat√≠sticas de Correla√ß√£o -->
        <div style="margin-top: 2rem; padding: 1.5rem; background: #f8f9fa; border-radius: 10px; border-left: 4px solid #667eea;">
          <h4 style="color: #2c3e50; margin-bottom: 1rem;">üìà An√°lise de Correla√ß√£o</h4>
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; font-size: 0.95rem;">
            <div>
              <strong style="color: #4CAF50;">üü¢ Faixa Verde:</strong>
              <p style="margin: 0.25rem 0; color: #555;">Correla√ß√£o positiva esperada com Score</p>
              <p id="correlVerdeScore" style="margin: 0; color: #667eea; font-weight: 600;"></p>
            </div>
            <div>
              <strong style="color: #f44336;">üî¥ Faixa Vermelha:</strong>
              <p style="margin: 0.25rem 0; color: #555;">Correla√ß√£o negativa esperada com Score</p>
              <p id="correlVermelhaScore" style="margin: 0; color: #667eea; font-weight: 600;"></p>
            </div>
            <div>
              <strong style="color: #667eea;">‚öôÔ∏è RPM M√©dio:</strong>
              <p style="margin: 0.25rem 0; color: #555;">Rela√ß√£o com efici√™ncia</p>
              <p id="correlRPMScore" style="margin: 0; color: #667eea; font-weight: 600;"></p>
            </div>
            <div>
              <strong style="color: #6c757d;">‚ö™ Ociosidade:</strong>
              <p style="margin: 0.25rem 0; color: #555;">Correla√ß√£o negativa esperada com Score</p>
              <p id="correlOciosoScore" style="margin: 0; color: #667eea; font-weight: 600;"></p>
            </div>
          </div>
        </div>
      </div>
      {% endif %}

      <!-- Tabela de Performance por Motorista -->
      {% if motoristas_performance %}
      <div style="background: white; border-radius: 15px; padding: 2rem; box-shadow: 0 10px 40px rgba(0,0,0,0.1); margin-bottom: 2rem;">
        <div style="overflow-x: auto;">
          <table class="sortable-table" style="width: 100%; border-collapse: collapse; font-size: 0.95rem;">
            <thead>
              <tr style="background: linear-gradient(135deg, #667eea, #764ba2); color: white;">
                <th style="padding: 1rem; text-align: center; border: 1px solid #dee2e6;">Ranking</th>
                <th style="padding: 1rem; text-align: left; border: 1px solid #dee2e6;">Motorista</th>
                <th style="padding: 1rem; text-align: center; border: 1px solid #dee2e6;">Ve√≠culos</th>
                <th style="padding: 1rem; text-align: center; border: 1px solid #dee2e6;">Pontos</th>
                <th style="padding: 1rem; text-align: center; border: 1px solid #dee2e6;">RPM M√©dio</th>
                <th style="padding: 1rem; text-align: center; border: 1px solid #dee2e6;">Vel. M√©dia</th>
                <th style="padding: 1rem; text-align: center; border: 1px solid #dee2e6;">üîµ Azul</th>
                <th style="padding: 1rem; text-align: center; border: 1px solid #dee2e6;">üü¢ Verde</th>
                <th style="padding: 1rem; text-align: center; border: 1px solid #dee2e6;">üü° Amarela</th>
                <th style="padding: 1rem; text-align: center; border: 1px solid #dee2e6;">üî¥ Vermelha</th>
                <th style="padding: 1rem; text-align: center; border: 1px solid #dee2e6;">‚ö™ Ocioso</th>
                <th style="padding: 1rem; text-align: center; border: 1px solid #dee2e6;">Score</th>
              </tr>
            </thead>
            <tbody>
              {% for item in motoristas_performance %}
              <tr style="background: {% cycle '#f8f9fa' 'white' %}; transition: all 0.3s ease;" onmouseover="this.style.background='#e3f2fd'" onmouseout="this.style.background='{% cycle '#f8f9fa' 'white' %}'">
                <td style="padding: 1rem; text-align: center; border: 1px solid #dee2e6; font-weight: 700; font-size: 1.2rem;">
                  {% if forloop.counter == 1 %}
                    ü•á
                  {% elif forloop.counter == 2 %}
                    ü•à
                  {% elif forloop.counter == 3 %}
                    ü•â
                  {% else %}
                    {{ forloop.counter }}
                  {% endif %}
                </td>
                <td style="padding: 1rem; border: 1px solid #dee2e6;">
                  <div style="font-weight: 600; color: #667eea;">
                    {{ item.motorista.nm|default:item.motorista.id }}
                  </div>
                  <div style="font-size: 0.85rem; color: #666;">
                    {{ item.motorista.empresa.nome|default:"-" }}
                  </div>
                </td>
                <td style="padding: 1rem; text-align: center; border: 1px solid #dee2e6; font-weight: 600;">
                  {{ item.total_veiculos }}
                </td>
                <td style="padding: 1rem; text-align: center; border: 1px solid #dee2e6; font-weight: 600;">
                  {{ item.total_pontos }}
                </td>
                <td style="padding: 1rem; text-align: center; border: 1px solid #dee2e6; font-weight: 600;">
                  {{ item.rpm_medio|floatformat:0 }}
                </td>
                <td style="padding: 1rem; text-align: center; border: 1px solid #dee2e6; font-weight: 600;">
                  {{ item.velocidade_media|floatformat:0 }} km/h
                </td>
                <td style="padding: 1rem; text-align: center; border: 1px solid #dee2e6;">
                  <div style="font-weight: 600; color: #2196F3; font-size: 1.1rem;">
                    {{ item.perc_azul|floatformat:1 }}%
                  </div>
                  <div style="font-size: 0.85rem; color: #666;">
                    ({{ item.faixa_azul }})
                  </div>
                </td>
                <td style="padding: 1rem; text-align: center; border: 1px solid #dee2e6;">
                  <div style="font-weight: 600; color: #4CAF50; font-size: 1.1rem;">
                    {{ item.perc_verde|floatformat:1 }}%
                  </div>
                  <div style="font-size: 0.85rem; color: #666;">
                    ({{ item.faixa_verde }})
                  </div>
                </td>
                <td style="padding: 1rem; text-align: center; border: 1px solid #dee2e6;">
                  <div style="font-weight: 600; color: #FF9800; font-size: 1.1rem;">
                    {{ item.perc_amarela|floatformat:1 }}%
                  </div>
                  <div style="font-size: 0.85rem; color: #666;">
                    ({{ item.faixa_amarela }})
                  </div>
                </td>
                <td style="padding: 1rem; text-align: center; border: 1px solid #dee2e6;">
                  <div style="font-weight: 600; color: #f44336; font-size: 1.1rem;">
                    {{ item.perc_vermelha|floatformat:1 }}%
                  </div>
                  <div style="font-size: 0.85rem; color: #666;">
                    ({{ item.faixa_vermelha }})
                  </div>
                </td>
                <td style="padding: 1rem; text-align: center; border: 1px solid #dee2e6;">
                  <div style="font-weight: 600; color: #6c757d; font-size: 1.1rem;">
                    {{ item.perc_ocioso|floatformat:1 }}%
                  </div>
                  <div style="font-size: 0.85rem; color: #666;">
                    ({{ item.motor_ocioso }})
                  </div>
                </td>
                <td style="padding: 1rem; text-align: center; border: 1px solid #dee2e6;">
                  <div style="padding: 0.5rem 1rem; border-radius: 20px; font-weight: 700; font-size: 1.1rem;
                    {% if item.score >= 70 %}
                      background: linear-gradient(135deg, #4CAF50, #8BC34A); color: white;
                    {% elif item.score >= 40 %}
                      background: linear-gradient(135deg, #FF9800, #FFC107); color: white;
                    {% else %}
                      background: linear-gradient(135deg, #f44336, #e91e63); color: white;
                    {% endif %}
                  ">
                    {{ item.score|floatformat:1 }}
                  </div>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
      {% else %}
      <div style="background: white; border-radius: 15px; padding: 3rem; text-align: center; box-shadow: 0 10px 40px rgba(0,0,0,0.1);">
        <div style="font-size: 4rem; margin-bottom: 1rem;">ÔøΩ‚Äç‚úàÔ∏è</div>
        <h3 style="color: #6c757d; margin-bottom: 1rem;">Nenhum motorista com dados dispon√≠veis</h3>
        <p style="color: #6c757d;">
          N√£o h√° dados de performance de motoristas no sistema para o per√≠odo selecionado.
          <br>Verifique se h√° dados de Viagem_eco com motoristas associados.
        </p>
      </div>
      {% endif %}

    </main>
    
    <footer class="footer">
      <p>&copy; 2025 Umbrella360. Transformando o Brasil atrav√©s da log√≠stica inteligente.</p>
      <p><em>"N√≥s enxergamos um mundo mais justo, mais humano e mais sustent√°vel."</em></p>
    </footer>

    <style>
    /* Estilos adicionais para responsividade */
    @media (max-width: 768px) {
      main {
        padding: 1rem !important;
      }
      
      .stats-grid {
        grid-template-columns: 1fr !important;
      }
      
      table {
        font-size: 0.75rem !important;
      }
      
      th, td {
        padding: 0.5rem !important;
      }
    }

    /* Anima√ß√µes de hover para cards */
    .stat-card {
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    
    .stat-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.2);
    }

    /* Estilo para links na tabela */
    .sortable-table a {
      transition: color 0.3s ease;
    }
    
    .sortable-table a:hover {
      color: #764ba2 !important;
      text-decoration: underline;
    }
    </style>
    <script>
    // Fun√ß√£o para mostrar/ocultar campos de data personalizada
    function toggleDateInputs(value) {
      const dataInicioDiv = document.getElementById('dataInicioDiv');
      const dataFimDiv = document.getElementById('dataFimDiv');
      
      if (value === 'personalizado') {
        dataInicioDiv.style.display = 'block';
        dataFimDiv.style.display = 'block';
      } else {
        dataInicioDiv.style.display = 'none';
        dataFimDiv.style.display = 'none';
        // Limpar valores se n√£o for personalizado
        document.getElementById('data_inicio').value = '';
        document.getElementById('data_fim').value = '';
      }
    }
    
    // Aplicar estilo hover aos bot√µes
    document.querySelectorAll('button, a[href*="performance"]').forEach(el => {
      el.addEventListener('mouseenter', function() {
        this.style.transform = 'translateY(-2px)';
      });
      el.addEventListener('mouseleave', function() {
        this.style.transform = 'translateY(0)';
      });
    });
  </script>

  <!-- Chart.js para os gr√°ficos de dispers√£o -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
  
  <script>
    {% if motoristas_performance %}
    // Preparar dados dos motoristas
    const motoristasData = [
      {% for item in motoristas_performance %}
      {
        nome: "{{ item.motorista.nm|default:item.motorista.id|escapejs }}",
        perc_verde: {{ item.perc_verde }},
        perc_vermelha: {{ item.perc_vermelha }},
        perc_azul: {{ item.perc_azul }},
        perc_amarela: {{ item.perc_amarela }},
        perc_ocioso: {{ item.perc_ocioso }},
        rpm_medio: {{ item.rpm_medio }},
        score: {{ item.score }},
        total_pontos: {{ item.total_pontos }}
      }{% if not forloop.last %},{% endif %}
      {% endfor %}
    ];

    // Fun√ß√£o para calcular correla√ß√£o de Pearson
    function calcularCorrelacao(arrayX, arrayY) {
      const n = arrayX.length;
      if (n === 0) return 0;
      
      const somaX = arrayX.reduce((a, b) => a + b, 0);
      const somaY = arrayY.reduce((a, b) => a + b, 0);
      const somaXY = arrayX.reduce((sum, x, i) => sum + x * arrayY[i], 0);
      const somaX2 = arrayX.reduce((sum, x) => sum + x * x, 0);
      const somaY2 = arrayY.reduce((sum, y) => sum + y * y, 0);
      
      const numerador = (n * somaXY) - (somaX * somaY);
      const denominador = Math.sqrt(((n * somaX2) - (somaX * somaX)) * ((n * somaY2) - (somaY * somaY)));
      
      return denominador === 0 ? 0 : numerador / denominador;
    }

    // Configura√ß√£o comum dos gr√°ficos
    const chartOptions = {
      responsive: true,
      maintainAspectRatio: true,
      plugins: {
        legend: {
          display: false
        },
        tooltip: {
          callbacks: {
            label: function(context) {
              const motorista = motoristasData[context.dataIndex];
              return [
                `Motorista: ${motorista.nome}`,
                `${context.dataset.label.split(' ')[0]}: ${context.parsed.x.toFixed(1)}`,
                `Score: ${context.parsed.y.toFixed(1)}`,
                `Pontos: ${motorista.total_pontos}`
              ];
            }
          }
        }
      },
      scales: {
        x: {
          title: {
            display: true,
            font: {
              size: 14,
              weight: 'bold'
            }
          },
          grid: {
            color: 'rgba(0, 0, 0, 0.05)'
          }
        },
        y: {
          title: {
            display: true,
            text: 'Score de Performance',
            font: {
              size: 14,
              weight: 'bold'
            }
          },
          grid: {
            color: 'rgba(0, 0, 0, 0.05)'
          }
        }
      }
    };

    // Fun√ß√£o para criar dataset de dispers√£o
    function criarDataset(label, dados, backgroundColor, borderColor) {
      return {
        label: label,
        data: dados,
        backgroundColor: backgroundColor,
        borderColor: borderColor,
        borderWidth: 2,
        pointRadius: 6,
        pointHoverRadius: 8,
      };
    }

    // Gr√°fico 1: % Faixa Verde vs Score
    const dadosVerdeScore = motoristasData.map(m => ({ x: m.perc_verde, y: m.score }));
    const correlVerdeScore = calcularCorrelacao(
      motoristasData.map(m => m.perc_verde),
      motoristasData.map(m => m.score)
    );
    
    new Chart(document.getElementById('chartVerdeScore'), {
      type: 'scatter',
      data: {
        datasets: [criarDataset('% Verde vs Score', dadosVerdeScore, 'rgba(76, 175, 80, 0.6)', 'rgba(76, 175, 80, 1)')]
      },
      options: {
        ...chartOptions,
        scales: {
          ...chartOptions.scales,
          x: {
            ...chartOptions.scales.x,
            title: {
              ...chartOptions.scales.x.title,
              text: '% Faixa Verde (Ideal)'
            }
          }
        }
      }
    });
    document.getElementById('correlVerdeScore').textContent = `r = ${correlVerdeScore.toFixed(3)} ${correlVerdeScore > 0.7 ? '(Forte Positiva)' : correlVerdeScore > 0.4 ? '(Moderada Positiva)' : correlVerdeScore > 0 ? '(Fraca Positiva)' : correlVerdeScore < -0.7 ? '(Forte Negativa)' : correlVerdeScore < -0.4 ? '(Moderada Negativa)' : '(Fraca Negativa)'}`;

    // Gr√°fico 2: % Faixa Vermelha vs Score
    const dadosVermelhaScore = motoristasData.map(m => ({ x: m.perc_vermelha, y: m.score }));
    const correlVermelhaScore = calcularCorrelacao(
      motoristasData.map(m => m.perc_vermelha),
      motoristasData.map(m => m.score)
    );
    
    new Chart(document.getElementById('chartVermelhaScore'), {
      type: 'scatter',
      data: {
        datasets: [criarDataset('% Vermelha vs Score', dadosVermelhaScore, 'rgba(244, 67, 54, 0.6)', 'rgba(244, 67, 54, 1)')]
      },
      options: {
        ...chartOptions,
        scales: {
          ...chartOptions.scales,
          x: {
            ...chartOptions.scales.x,
            title: {
              ...chartOptions.scales.x.title,
              text: '% Faixa Vermelha (Cr√≠tica)'
            }
          }
        }
      }
    });
    document.getElementById('correlVermelhaScore').textContent = `r = ${correlVermelhaScore.toFixed(3)} ${correlVermelhaScore > 0.7 ? '(Forte Positiva)' : correlVermelhaScore > 0.4 ? '(Moderada Positiva)' : correlVermelhaScore > 0 ? '(Fraca Positiva)' : correlVermelhaScore < -0.7 ? '(Forte Negativa)' : correlVermelhaScore < -0.4 ? '(Moderada Negativa)' : '(Fraca Negativa)'}`;

    // Gr√°fico 3: RPM M√©dio vs Score
    const dadosRPMScore = motoristasData.map(m => ({ x: m.rpm_medio, y: m.score }));
    const correlRPMScore = calcularCorrelacao(
      motoristasData.map(m => m.rpm_medio),
      motoristasData.map(m => m.score)
    );
    
    new Chart(document.getElementById('chartRPMScore'), {
      type: 'scatter',
      data: {
        datasets: [criarDataset('RPM M√©dio vs Score', dadosRPMScore, 'rgba(102, 126, 234, 0.6)', 'rgba(102, 126, 234, 1)')]
      },
      options: {
        ...chartOptions,
        scales: {
          ...chartOptions.scales,
          x: {
            ...chartOptions.scales.x,
            title: {
              ...chartOptions.scales.x.title,
              text: 'RPM M√©dio'
            }
          }
        }
      }
    });
    document.getElementById('correlRPMScore').textContent = `r = ${correlRPMScore.toFixed(3)} ${correlRPMScore > 0.7 ? '(Forte Positiva)' : correlRPMScore > 0.4 ? '(Moderada Positiva)' : correlRPMScore > 0 ? '(Fraca Positiva)' : correlRPMScore < -0.7 ? '(Forte Negativa)' : correlRPMScore < -0.4 ? '(Moderada Negativa)' : '(Fraca Negativa)'}`;

    // Gr√°fico 4: % Ociosidade vs Score
    const dadosOciosoScore = motoristasData.map(m => ({ x: m.perc_ocioso, y: m.score }));
    const correlOciosoScore = calcularCorrelacao(
      motoristasData.map(m => m.perc_ocioso),
      motoristasData.map(m => m.score)
    );
    
    new Chart(document.getElementById('chartOciosoScore'), {
      type: 'scatter',
      data: {
        datasets: [criarDataset('% Ociosidade vs Score', dadosOciosoScore, 'rgba(108, 117, 125, 0.6)', 'rgba(108, 117, 125, 1)')]
      },
      options: {
        ...chartOptions,
        scales: {
          ...chartOptions.scales,
          x: {
            ...chartOptions.scales.x,
            title: {
              ...chartOptions.scales.x.title,
              text: '% Tempo em Ociosidade'
            }
          }
        }
      }
    });
    document.getElementById('correlOciosoScore').textContent = `r = ${correlOciosoScore.toFixed(3)} ${correlOciosoScore > 0.7 ? '(Forte Positiva)' : correlOciosoScore > 0.4 ? '(Moderada Positiva)' : correlOciosoScore > 0 ? '(Fraca Positiva)' : correlOciosoScore < -0.7 ? '(Forte Negativa)' : correlOciosoScore < -0.4 ? '(Moderada Negativa)' : '(Fraca Negativa)'}`;

    {% endif %}
  </script>
  </body>
</html>